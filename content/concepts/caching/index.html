<!doctype html>
<html class="no-js" lang="en" data-content_root="../../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="article:modified_time" content="2025-06-23T04:04:22+00:00" /><link rel="index" title="Index" href="../../genindex/" /><link rel="search" title="Search" href="../../search/" /><link rel="next" title="Function modifiers (Advanced)" href="../function-modifiers-advanced/" /><link rel="prev" title="Builder" href="../builder/" />
        <link rel="canonical" href="https://hamilton.staged.apache.org/concepts/caching/" />

    <!-- Generated with Sphinx 8.2.3 and Furo 2024.08.06 -->
        <title>Caching - Hamilton</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo.css?v=354aac6f" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/furo-extensions.css?v=302659d7" />
    <link rel="stylesheet" type="text/css" href="../../_static/testimonials.css?v=bd684830" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  --color-announcement-background: #ffba00;
  --color-announcement-text: #091E42;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: #ffba00;
  --color-announcement-text: #091E42;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  --color-announcement-background: #ffba00;
  --color-announcement-text: #091E42;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>

<div class="announcement">
  <aside class="announcement-content">
     ðŸ“¢ Announcing the <a target="_blank" href="https://www.meetup.com/global-hamilton-open-source-user-group-meetup/">Hamilton Meetup Group</a>. Sign up to attend events! ðŸ“¢ 
  </aside>
</div>

<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../../"><div class="brand">Hamilton</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../../">
  
  
  <span class="sidebar-brand-text">Hamilton</span>
  
</a><form class="sidebar-search-container" method="get" action="../../search/" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">USER GUIDE</span></p>
<ul class="current">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../get-started/">Get Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" role="switch" type="checkbox"/><label for="toctree-checkbox-1"><div class="visually-hidden">Toggle navigation of Get Started</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/why-hamilton/">Why use Apache Hamilton?</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/install/">Install</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/your-first-dataflow/">Your First Dataflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/learning-resources/">Learning Resources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/contributing/">Contributing</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../get-started/license/">License</a></li>
</ul>
</li>
<li class="toctree-l1 current has-children"><a class="reference internal" href="../">Concepts</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" role="switch" type="checkbox"/><label for="toctree-checkbox-2"><div class="visually-hidden">Toggle navigation of Concepts</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../glossary/">Glossary</a></li>
<li class="toctree-l2"><a class="reference internal" href="../node/">Functions, nodes &amp; dataflow</a></li>
<li class="toctree-l2"><a class="reference internal" href="../driver/">Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../visualization/">Visualization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../materialization/">Materialization</a></li>
<li class="toctree-l2"><a class="reference internal" href="../function-modifiers/">Function modifiers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../builder/">Builder</a></li>
<li class="toctree-l2 current current-page"><a class="current reference internal" href="#">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../function-modifiers-advanced/">Function modifiers (Advanced)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../parallel-task/">Dynamic DAGs/Parallel Execution</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ui/">UI Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ui/#local-mode">Local Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ui/#docker-deployed-mode">Docker/Deployed Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ui/#get-started">Get started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ui/#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../ui/#sdk-configuration">SDK Configuration</a></li>
<li class="toctree-l2 has-children"><a class="reference internal" href="../best-practices/">Best Practices</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" role="switch" type="checkbox"/><label for="toctree-checkbox-3"><div class="visually-hidden">Toggle navigation of Best Practices</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l3"><a class="reference internal" href="../best-practices/function-naming/">Function Naming</a></li>
<li class="toctree-l3"><a class="reference internal" href="../best-practices/migrating-to-hamilton/">Migrating to Apache Hamilton</a></li>
<li class="toctree-l3"><a class="reference internal" href="../best-practices/code-organization/">Code Organization</a></li>
<li class="toctree-l3"><a class="reference internal" href="../best-practices/common-indices/">Common Indices</a></li>
<li class="toctree-l3"><a class="reference internal" href="../best-practices/output-immutability/">Output Immutability</a></li>
<li class="toctree-l3"><a class="reference internal" href="../best-practices/using-within-your-etl-system/">Using within your ETL System</a></li>
<li class="toctree-l3"><a class="reference internal" href="../best-practices/loading-data/">Loading Data</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../how-tos/">User Guide</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" role="switch" type="checkbox"/><label for="toctree-checkbox-4"><div class="visually-hidden">Toggle navigation of User Guide</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/use-in-jupyter-notebook/">Jupyter notebooks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/load-data/">Loading data</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/caching-tutorial/">Caching</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/use-for-feature-engineering/">Feature engineering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/ml-training/">Model training</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/llm-workflows/">LLM workflows</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/run-data-quality-checks/">Data quality</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/use-hamilton-for-lineage/">Lineage + Apache Hamilton</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/scale-up/">Scaling computation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/microservice/">Microservice</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/extensions-autoloading/">Extension autoloading</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/wrapping-driver/">Wrapping the Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/cli-reference/">Command line interface</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../how-tos/pre-commit-hooks/">pre-commit hooks</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../hamilton-ui/">Apache Hamilton UI</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" role="switch" type="checkbox"/><label for="toctree-checkbox-5"><div class="visually-hidden">Toggle navigation of Apache Hamilton UI</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../hamilton-ui/ui/">UI Overview</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hamilton-ui/ui/#local-mode">Local Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hamilton-ui/ui/#docker-deployed-mode">Docker/Deployed Mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hamilton-ui/ui/#get-started">Get started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hamilton-ui/ui/#features">Features</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hamilton-ui/ui/#sdk-configuration">SDK Configuration</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../hamilton-vscode/">IDE extension</a><input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" role="switch" type="checkbox"/><label for="toctree-checkbox-6"><div class="visually-hidden">Toggle navigation of IDE extension</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../hamilton-vscode/vscode_extension/">Apache Hamilton VSCode</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../hamilton-vscode/language_server/">Language Server</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../integrations/">Integrations</a><input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" role="switch" type="checkbox"/><label for="toctree-checkbox-7"><div class="visually-hidden">Toggle navigation of Integrations</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/dlt/">dlt</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/fastapi/">FastAPI</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/ibis/">Ibis</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/streamlit/">Streamlit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../integrations/dbt/">dbt</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/mlflow">MLFlow</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/airflow">Airflow</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/aws">Amazon Web Services</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/LLM_Workflows/image_telephone">Burr</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/dagster">Dagster</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/dask">Dask</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/feast">Feast</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/outerbounds/hamilton-metaflow">Metaflow</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/data_quality/pandera">Pandera</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/plotly">Plotly</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/polars">Polars</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/prefect">Prefect</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/ray">Ray</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/slack">Slack</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/spark">Spark</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/vaex">Vaex</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/narwhals">Narwhals</a></li>
<li class="toctree-l2"><a class="reference external" href="https://github.com/apache/hamilton/tree/main/examples/openlineage">OpenLineage</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../code-comparisons/">Code Comparisons</a><input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" role="switch" type="checkbox"/><label for="toctree-checkbox-8"><div class="visually-hidden">Toggle navigation of Code Comparisons</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../code-comparisons/kedro/">Kedro</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code-comparisons/dagster/">Dagster</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code-comparisons/langchain/">LangChain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../code-comparisons/airflow/">Airflow</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">PDF</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://hamilton.apache.org/_static/Hamilton.pdf">PDF</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../community/">Meet-ups</a></li>
<li class="toctree-l1"><a class="reference external" href="https://join.slack.com/t/hamilton-opensource/shared_invite/zt-2niepkra8-DGKGf_tTYhXuJWBTXtIs4g">Slack</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">REFERENCE</span></p>
<ul>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/decorators/">Decorators</a><input class="toctree-checkbox" id="toctree-checkbox-9" name="toctree-checkbox-9" role="switch" type="checkbox"/><label for="toctree-checkbox-9"><div class="visually-hidden">Toggle navigation of Decorators</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/check_output/">check_output*</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/config_when/">config.when*</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/dataloader/">dataloader</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/datasaver/">datasaver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/does/">does</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/extract_columns/">extract_columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/extract_fields/">extract_fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/inject/">inject</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/load_from/">load_from</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/parameterize/">parameterize</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/parameterize_extract_columns/">parameterize_extract_columns</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/parameterize_frame/">parameterize_frame</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/parameterize_sources/">parameterize_sources</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/parameterize_subdag/">parameterized_subdag</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/parameterize_values/">parameterize_values</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/pipe/">pipe family</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/resolve/">resolve</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/save_to/">save_to</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/subdag/">subdag</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/schema/">schema</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/tag/">tag*</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/decorators/with_columns/">with_columns</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/drivers/">Drivers</a><input class="toctree-checkbox" id="toctree-checkbox-10" name="toctree-checkbox-10" role="switch" type="checkbox"/><label for="toctree-checkbox-10"><div class="visually-hidden">Toggle navigation of Drivers</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/drivers/Driver/">Builder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/drivers/Driver/#driver">Driver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/drivers/Driver/#defaultgraphexecutor">DefaultGraphExecutor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/drivers/Driver/#taskbasedgraphexecutor">TaskBasedGraphExecutor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/drivers/AsyncDriver/">AsyncDriver</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/drivers/Custom/">Custom Driver</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/caching/">Caching</a><input class="toctree-checkbox" id="toctree-checkbox-11" name="toctree-checkbox-11" role="switch" type="checkbox"/><label for="toctree-checkbox-11"><div class="visually-hidden">Toggle navigation of Caching</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/caching/caching-logic/">Caching logic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/caching/data-versioning/">Data versioning</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/caching/stores/">Stores</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/graph-adapters/">GraphAdapters</a><input class="toctree-checkbox" id="toctree-checkbox-12" name="toctree-checkbox-12" role="switch" type="checkbox"/><label for="toctree-checkbox-12"><div class="visually-hidden">Toggle navigation of GraphAdapters</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/SimplePythonDataFrameGraphAdapter/">SimplePythonDataFrameGraphAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/SimplePythonGraphAdapter/">SimplePythonGraphAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/HamiltonGraphAdapter/">HamiltonGraphAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/AsyncGraphAdapter/">h_async.AsyncGraphAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/ThreadPoolFutureAdapter/">h_threadpool.FutureAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/CachingGraphAdapter/">CachingGraphAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/DaskGraphAdapter/">h_dask.DaskGraphAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/PySparkUDFGraphAdapter/">h_spark.PySparkUDFGraphAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/RayGraphAdapter/">h_ray.RayGraphAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/RayWorkflowGraphAdapter/">h_ray.RayWorkflowGraphAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/graph-adapters/SparkKoalasGraphAdapter/">h_spark.SparkKoalasGraphAdapter</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/lifecycle-hooks/">Lifecycle Adapters</a><input class="toctree-checkbox" id="toctree-checkbox-13" name="toctree-checkbox-13" role="switch" type="checkbox"/><label for="toctree-checkbox-13"><div class="visually-hidden">Toggle navigation of Lifecycle Adapters</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/ResultBuilder/">lifecycle.ResultBuilder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/LegacyResultMixin/">lifecycle.LegacyResultMixin</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/GraphAdapter/">lifecycle.api.GraphAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/NodeExecutionHook/">lifecycle.NodeExecutionHook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/GraphExecutionHook/">lifecycle.api.GraphExecutionHook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/EdgeConnectionHook/">lifecycle.api.EdgeConnectionHook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/NodeExecutionMethod/">lifecycle.api.NodeExecutionMethod</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/StaticValidator/">lifecycle.api.StaticValidator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/GraphConstructionHook/">lifecycle.api.GraphConstructionHook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/TaskSubmissionHook/">lifecycle.api.TaskSubmissionHook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/TaskReturnHook/">lifecycle.api.TaskReturnHook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/TaskExecutionHook/">lifecycle.api.TaskExecutionHook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/TaskGroupingHook/">lifecycle.api.TaskGroupingHook</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/PDBDebugger/">lifecycle.PDBDebugger</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/PrintLn/">lifecycle.PrintLn</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/ProgressBar/">plugins.h_tqdm.ProgressBar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/RichProgressBar/">plugins.h_rich.RichProgressBar</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/DDOGTracer/">plugins.h_ddog.DDOGTracer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/FunctionInputOutputTypeChecker/">lifecycle.FunctionInputOutputTypeChecker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/SlackNotifierHook/">plugins.h_slack.SlackNotifier</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/GracefulErrorAdapter/">lifecycle.GracefulErrorAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/SparkInputValidator/">plugins.h_spark.SparkInputValidator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/Narwhals/">plugins.h_narhwals.NarwhalsAdapter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/Narwhals/#plugins-h-narhwals-narwhalsdataframeresultbuilder">plugins.h_narhwals.NarwhalsDataFrameResultBuilder</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/MLFlowTracker/">plugins.h_mlflow.MLFlowTracker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/NoEdgeAndInputTypeChecking/">lifecycle.NoEdgeAndInputTypeChecking</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/lifecycle-hooks/OpenLineageAdapter/">plugins.h_openlineage.OpenLineageAdapter</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/result-builders/">ResultBuilders</a><input class="toctree-checkbox" id="toctree-checkbox-14" name="toctree-checkbox-14" role="switch" type="checkbox"/><label for="toctree-checkbox-14"><div class="visually-hidden">Toggle navigation of ResultBuilders</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/result-builders/Generic/">Generic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/result-builders/Numpy/">Numpy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/result-builders/Pandas/">Pandas</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/result-builders/Polars/">Polars</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/result-builders/Dask/">Dask</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/result-builders/Custom/">Custom ResultBuilder</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/io/">I/O</a><input class="toctree-checkbox" id="toctree-checkbox-15" name="toctree-checkbox-15" role="switch" type="checkbox"/><label for="toctree-checkbox-15"><div class="visually-hidden">Toggle navigation of I/O</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/io/available-data-adapters/">Using Data Adapters</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/io/available-data-adapters/#data-loaders">Data Loaders</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/io/available-data-adapters/#data-savers">Data Savers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/io/adapter-documentation/">Data Adapters</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../../reference/dataflows/">Dataflows</a><input class="toctree-checkbox" id="toctree-checkbox-16" name="toctree-checkbox-16" role="switch" type="checkbox"/><label for="toctree-checkbox-16"><div class="visually-hidden">Toggle navigation of Dataflows</div><i class="icon"><svg><use href="#svg-arrow-right"></use></svg></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dataflows/clear_storage/">clear_storage()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dataflows/copy/">copy()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dataflows/find/">find()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dataflows/import_module/">import_module()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dataflows/inspect/">inspect()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dataflows/inspect_module/">inspect_module()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dataflows/install_dependencies_string/">install_dependencies_string()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dataflows/latest_commit/">latest_commit()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dataflows/list/">list()</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/dataflows/pull_module/">pull_module()</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/disabling-telemetry/">Telemetry</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">EXTERNAL RESOURCES</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/apache/hamilton">GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://www.tryhamilton.dev/">tryhamilton.dev</a></li>
<li class="toctree-l1"><a class="reference external" href="https://hub.dagworks.io/docs/">Dataflow Hub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://blog.dagworks.io/">Blog</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="https://github.com/apache/hamilton/blob/main/docs/concepts/caching.rst?plain=true" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div><div class="edit-this-page">
  <a class="muted-link" href="https://github.com/apache/hamilton/edit/main/docs/concepts/caching.rst" title="Edit this page">
    <svg><use href="#svg-pencil"></use></svg>
    <span class="visually-hidden">Edit this page</span>
  </a>
</div><div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="caching">
<h1>Caching<a class="headerlink" href="#caching" title="Link to this heading">Â¶</a></h1>
<p>Caching enables storing execution results to be reused in later executions, effectively skipping redundant computations. This speeds up execution and saves resources (computation, API credits, GPU time, etc.), and has applications both for development and production.</p>
<p>To enable caching, add <code class="docutils literal notranslate"><span class="pre">.with_cache()</span></code> to your <code class="docutils literal notranslate"><span class="pre">Builder()</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">my_dataflow</span>

<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_module</span><span class="p">(</span><span class="n">my_dataflow</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_cache</span><span class="p">()</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">dr</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="o">...</span><span class="p">])</span>
<span class="n">dr</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="o">...</span><span class="p">])</span>
</pre></div>
</div>
<p>The first execution will store <strong>metadata</strong> and <strong>results</strong> next to the current directory under <code class="docutils literal notranslate"><span class="pre">./.hamilton_cache</span></code>. The next execution will retrieve results from cache when possible to skip execution.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>We highly suggest viewing the <a class="reference internal" href="../../how-tos/caching-tutorial/"><span class="doc">Caching</span></a> tutorial for a practical introduction to caching.</p>
</div>
<section id="how-does-it-work">
<h2>How does it work?<a class="headerlink" href="#how-does-it-work" title="Link to this heading">Â¶</a></h2>
<p>Caching relies on multiple components:</p>
<ul class="simple">
<li><p><strong>Cache adapter</strong>: decide to retrieve a result or execute the node</p></li>
<li><p><strong>Metadata store</strong>: store information about past node executions</p></li>
<li><p><strong>Result store</strong>: store results on disk, it is unaware of other cache components.</p></li>
</ul>
<p>At a high-level, the cache adapter does the following for each node:</p>
<ol class="arabic simple">
<li><p>Before execution: determine the <code class="docutils literal notranslate"><span class="pre">cache_key</span></code></p></li>
<li><dl class="simple">
<dt>At execution:</dt><dd><ol class="loweralpha simple">
<li><p>if the <code class="docutils literal notranslate"><span class="pre">cache_key</span></code> finds a match in the metadata store (cache <strong>hit</strong>), retrieve the <code class="docutils literal notranslate"><span class="pre">data_version</span></code> of the <code class="docutils literal notranslate"><span class="pre">result</span></code>.</p></li>
<li><p>If thereâ€™s no match (cache <strong>miss</strong>), execute the node and store the <code class="docutils literal notranslate"><span class="pre">data_version</span></code> of the <code class="docutils literal notranslate"><span class="pre">result</span></code> in the metadata store.</p></li>
</ol>
</dd>
</dl>
</li>
<li><p>After execution: if we had to execute the node, store the <code class="docutils literal notranslate"><span class="pre">result</span></code> in the result store.</p></li>
</ol>
<p>The caching mechanism is highly performant because it can pass <code class="docutils literal notranslate"><span class="pre">data_version</span></code> (small strings) through the dataflow instead of the actual data until a node needs to be executed.</p>
<p>The result store is a mapping of <code class="docutils literal notranslate"><span class="pre">{data_version:</span> <span class="pre">result}</span></code>. While a <code class="docutils literal notranslate"><span class="pre">cache_key</span></code> is unique to determine retrieval or execution, multiple cache keys can point to the same <code class="docutils literal notranslate"><span class="pre">data_version</span></code>, which avoid storing duplicate results.</p>
<section id="cache-key">
<h3>Cache key<a class="headerlink" href="#cache-key" title="Link to this heading">Â¶</a></h3>
<p>Understanding the <code class="docutils literal notranslate"><span class="pre">cache_key</span></code> is important to understand why a node is recomputed or not. It is composed of:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">node_name</span></code>: name of the node</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">code_version</span></code>: version of the nodeâ€™s code</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">dependencies_data_versions</span></code>: <code class="docutils literal notranslate"><span class="pre">data_version</span></code> of each dependency of the node</p></li>
</ul>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
<span class="w">    </span><span class="nt">&quot;node_name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;processed_data&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;code_version&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;c2ccafa54280fbc969870b6baa445211277d7e8cfa98a0821836c175603ffda2&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="nt">&quot;dependencies_data_versions&quot;</span><span class="p">:</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="nt">&quot;raw_data&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;WgV5-4SfdKTfUY66x-msj_xXsKNPNTP2guRhfw==&quot;</span><span class="p">,</span>
<span class="w">        </span><span class="nt">&quot;date&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;ZWNhd-XNlIF0YV9-2ZXJzaW9u_YGAgKA==&quot;</span><span class="p">,</span>
<span class="w">    </span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>By traversing the cache keysâ€™ <code class="docutils literal notranslate"><span class="pre">dependencies_data_versions</span></code>, we can actually reconstruct the dataflow structure!</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Cache keys could be unstable across Python and Apache Hamilton versions (because of new features, bug fixes, etc.). Upgrading Python or Apache Hamilton could require starting with a new empty cache for reliable behavior.</p>
</div>
</section>
</section>
<section id="observing-the-cache">
<h2>Observing the cache<a class="headerlink" href="#observing-the-cache" title="Link to this heading">Â¶</a></h2>
<p>Caching is best understood throung interacting with it. Apache Hamilton offers many utilities to observe and introspect the cache manually.</p>
<section id="logging">
<h3>Logging<a class="headerlink" href="#logging" title="Link to this heading">Â¶</a></h3>
<p>To see how the cache works step-by-step, start your code (script, notebook, etc.) by getting the logger and setting the level to <code class="docutils literal notranslate"><span class="pre">DEBUG</span></code>. Using <code class="docutils literal notranslate"><span class="pre">INFO</span></code> will be less noisy and only log <code class="docutils literal notranslate"><span class="pre">GET_RESULT</span></code> and <code class="docutils literal notranslate"><span class="pre">EXECUTE_NODE</span></code> events.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;hamilton.caching&quot;</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">setLevel</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>
<span class="n">logger</span><span class="o">.</span><span class="n">addHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">StreamHandler</span><span class="p">())</span>  <span class="c1"># this handler will print to the console</span>
</pre></div>
</div>
<p>The logs follow the structure <code class="docutils literal notranslate"><span class="pre">{node_name}::{task_id}::{actor}::{event_type}::{message}</span></code>, omitting empty sections.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp"># </span>example<span class="w"> </span>INFO<span class="w"> </span>logs<span class="w"> </span><span class="k">for</span><span class="w"> </span>nodes<span class="w"> </span>foo,<span class="w"> </span>bar,<span class="w"> </span>and<span class="w"> </span>baz
<span class="go">foo::result_store::get_result::hit</span>
<span class="go">bar::adapter::execute_node</span>
<span class="go">baz::adapter::execute_node</span>
</pre></div>
</div>
</section>
<section id="visualization">
<h3>Visualization<a class="headerlink" href="#visualization" title="Link to this heading">Â¶</a></h3>
<p>After <code class="docutils literal notranslate"><span class="pre">Driver</span></code> execution, calling <code class="docutils literal notranslate"><span class="pre">dr.cache.view_run()</span></code> will create a visualization of the dataflow with results retrieved from the cache highlighted.</p>
<p>By default, it shows the latest run, but itâ€™s possible to view previous runs by passing a <code class="docutils literal notranslate"><span class="pre">run_id</span></code>. Specify a <code class="docutils literal notranslate"><span class="pre">output_file_path</span></code> to save the visualization.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># ... define and execute a `Driver`</span>

<span class="c1"># select the 3rd unique run_id</span>
<span class="n">run_id_3</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">run_ids</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
<span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">view_run</span><span class="p">(</span><span class="n">run_id</span><span class="o">=</span><span class="n">run_id_3</span><span class="p">,</span> <span class="n">output_file_path</span><span class="o">=</span><span class="s2">&quot;cached_run_3.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id1">
<img alt="../../_images/view_run_example.svg" src="../../_images/view_run_example.svg" />
<figcaption>
<p><span class="caption-text">Visualization produced by <code class="docutils literal notranslate"><span class="pre">dr.cache.view_run()</span></code>. Retrieved results are outlined.</span><a class="headerlink" href="#id1" title="Link to this image">Â¶</a></p>
</figcaption>
</figure>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The method <code class="docutils literal notranslate"><span class="pre">.view_run()</span></code> doensâ€™t currently support task-based execution or <code class="docutils literal notranslate"><span class="pre">Parallelizable/Collect</span></code>.</p>
</div>
</section>
<section id="structured-logs">
<span id="caching-structured-logs"></span><h3>Structured logs<a class="headerlink" href="#structured-logs" title="Link to this heading">Â¶</a></h3>
<p>Structured logs are stored on the <code class="docutils literal notranslate"><span class="pre">Driver.cache</span></code> and can be inspected programmatically. By setting <code class="docutils literal notranslate"><span class="pre">.with_cache(log_to_file=True)</span></code>, structured logs will also be appended to a <code class="docutils literal notranslate"><span class="pre">.jsonl</span></code> file as they happen; this is ideal for production usage.</p>
<p>To access log, use <code class="docutils literal notranslate"><span class="pre">Driver.cache.logs()</span></code>. You can <code class="docutils literal notranslate"><span class="pre">.logs(level=...)</span></code> to <code class="docutils literal notranslate"><span class="pre">&quot;info&quot;</span></code> or <code class="docutils literal notranslate"><span class="pre">&quot;debug&quot;</span></code> to view only <code class="docutils literal notranslate"><span class="pre">GET_RESULT</span></code> and <code class="docutils literal notranslate"><span class="pre">EXECUTE_NODE</span></code> or all events. Specifying <code class="docutils literal notranslate"><span class="pre">.logs(run_id=...)</span></code> will return logs from a given run, and leaving it empty will returns logs for all executions of this <code class="docutils literal notranslate"><span class="pre">Driver</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">logs</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>The shape of the returned object is slightly diffrent if specifying a <code class="docutils literal notranslate"><span class="pre">run_id</span></code> or not. Specifying a <code class="docutils literal notranslate"><span class="pre">run_id</span></code> will give <code class="docutils literal notranslate"><span class="pre">{node_name:</span> <span class="pre">List[CachingEvent]}</span></code></p>
<p>Requesting <code class="docutils literal notranslate"><span class="pre">Driver.cache.logs()</span></code> will return a dictionary with <code class="docutils literal notranslate"><span class="pre">run_id</span></code> as key and list of <code class="docutils literal notranslate"><span class="pre">CachingEvent</span></code> as values <code class="docutils literal notranslate"><span class="pre">{run_id:</span> <span class="pre">List[CachingEvent]}</span></code>. This is useful for comparing run and verify nodes were properly executed or retrieved.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">logs</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">,</span> <span class="n">run_id</span><span class="o">=</span><span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">last_run_id</span><span class="p">)</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;raw_data&#39;: [CachingEvent(...), ...],</span>
<span class="c1">#     &#39;processed_data&#39;: [CachingEvent(...), ...],</span>
<span class="c1">#     &#39;amount_per_country&#39;: [CachingEvent(...), ...]</span>
<span class="c1"># }</span>

<span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">logs</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">)</span>
<span class="c1"># {</span>
<span class="c1">#     &#39;run_id_1&#39;: [CachingEvent(...), ...],</span>
<span class="c1">#     &#39;run_id_2&#39;: [CachingEvent(...), ...]</span>
<span class="c1"># }</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When using <code class="docutils literal notranslate"><span class="pre">Parallelizable/Collect</span></code>, nodes part of the â€œparallel branchesâ€ will have a <code class="docutils literal notranslate"><span class="pre">task_id</span></code> key too <code class="docutils literal notranslate"><span class="pre">{node_name:</span> <span class="pre">{task_id:</span> <span class="pre">List[CachingEvent]}}</span></code> while nodes outside branches will remain <code class="docutils literal notranslate"><span class="pre">{node_name:</span> <span class="pre">List[CachingEvent]}</span></code></p>
</div>
</section>
</section>
<section id="cached-result-format">
<span id="cache-result-format"></span><h2>Cached result format<a class="headerlink" href="#cached-result-format" title="Link to this heading">Â¶</a></h2>
<p>By default, caching uses the <code class="docutils literal notranslate"><span class="pre">pickle</span></code> format because it can accomodate almost all Python objects. Although, it has <a class="reference external" href="https://grantjenks.com/docs/diskcache/tutorial.html#caveats">caveats</a>. The <code class="docutils literal notranslate"><span class="pre">cache</span></code> decorator allows you to use a different format for a given node (<code class="docutils literal notranslate"><span class="pre">JSON</span></code>, <code class="docutils literal notranslate"><span class="pre">CSV</span></code>, <code class="docutils literal notranslate"><span class="pre">Parquet</span></code>, etc.).</p>
<p>The next snippet caches <code class="docutils literal notranslate"><span class="pre">clean_dataset</span></code> as <code class="docutils literal notranslate"><span class="pre">parquet</span></code>, and <code class="docutils literal notranslate"><span class="pre">statistics</span></code> as <code class="docutils literal notranslate"><span class="pre">json</span></code>. These formats maybe more reliable, efficient, and easier to work with.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_dataflow.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.function_modifiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">cache</span>

<span class="k">def</span><span class="w"> </span><span class="nf">raw_data</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="nd">@cache</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;parquet&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">clean_dataset</span><span class="p">(</span><span class="n">raw_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">raw_data</span>

<span class="nd">@cache</span><span class="p">(</span><span class="nb">format</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">statistics</span><span class="p">(</span><span class="n">clean_dataset</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="k">return</span> <span class="o">...</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">driver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">my_dataflow</span>

<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">my_dataflow</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_cache</span><span class="p">()</span>
    <span class="o">.</span><span class="n">buid</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># first execution will product a ``parquet`` file for  ``clean_dataset``</span>
<span class="c1"># and a ``json`` file for ``statistics``</span>
<span class="n">dr</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;statistics&quot;</span><span class="p">])</span>
<span class="c1"># second execution will use these parquet and json files when loading results</span>
<span class="n">dr</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;statistics&quot;</span><span class="p">])</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Internally, this uses <a class="reference internal" href="../materialization/"><span class="doc">Materializers</span></a></p>
</div>
</section>
<section id="caching-behavior">
<h2>Caching behavior<a class="headerlink" href="#caching-behavior" title="Link to this heading">Â¶</a></h2>
<p>The <strong>caching behavior</strong> refers to the caching logic used to:
- version data
- load and store metadata
- load and store results
- execute or not a node</p>
<p>The <code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code> behavior aims to be easy to use and facilitate iterative development. However, other behavior may be desirble in particular scenarios or when going to production. The behavior can be set node-by-node.</p>
<ol class="arabic simple">
<li><p><code class="docutils literal notranslate"><span class="pre">DEFAULT</span></code>: Try to retrieve results from cache instead of executing the node. Node result and metadata are stored.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">RECOMPUTE</span></code>: Always execute the node / never retrieve from cache. Result and metadata are stored. This can be useful to ensure external data is alawys reloaded.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">DISABLE</span></code>: Act as if caching isnâ€™t enabled for this node. Nodes depending on a disabled node will miss metadata for cache retrieval, forcing their re-execution. Useful for disabling caching in parts of the dataflow.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">IGNORE</span></code>: Similar to <strong>Disable</strong>, but downstream nodes will ignore the missing metadata and can successfully retrieve results. Useful to ignore â€œirrelevantâ€ nodes that shouldnâ€™t impact the results (e.g., credentials, API clients, database connections).</p></li>
</ol>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Learn more in the <a class="reference internal" href="../../reference/caching/caching-logic/"><span class="doc">Caching logic</span></a> reference section.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There are other caching behaviors theoretically possible, but these four should cover most cases. Let us know if you have a use case that is not covered.</p>
</div>
<section id="setting-caching-behavior">
<h3>Setting caching behavior<a class="headerlink" href="#setting-caching-behavior" title="Link to this heading">Â¶</a></h3>
<p>The caching behavior can be specified at the node-level via the <code class="docutils literal notranslate"><span class="pre">&#64;cache</span></code> function modifier or at the builder-level via <code class="docutils literal notranslate"><span class="pre">.with_cache(...)</span></code> arguments. Note that the behavior specified by the <code class="docutils literal notranslate"><span class="pre">Builder</span></code> will override the behavior from <code class="docutils literal notranslate"><span class="pre">&#64;cache</span></code> since itâ€™s closer to execution.</p>
</section>
<section id="via-cache">
<h3>via <code class="docutils literal notranslate"><span class="pre">&#64;cache</span></code><a class="headerlink" href="#via-cache" title="Link to this heading">Â¶</a></h3>
<p>Below, we set <code class="docutils literal notranslate"><span class="pre">raw_data</span></code> to <code class="docutils literal notranslate"><span class="pre">RECOMPUTE</span></code> because the file it loads data from may change between executions. After executing and versioning the result of <code class="docutils literal notranslate"><span class="pre">raw_data</span></code>, if the data didnâ€™t change from previous execution, weâ€™ll be able to retrieve <code class="docutils literal notranslate"><span class="pre">clean_dataset</span></code> and <code class="docutils literal notranslate"><span class="pre">statistics</span></code> from cache.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># my_dataflow.py</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.function_modifiers</span><span class="w"> </span><span class="kn">import</span> <span class="n">cache</span>

<span class="nd">@cache</span><span class="p">(</span><span class="n">behavior</span><span class="o">=</span><span class="s2">&quot;recompute&quot;</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">raw_data</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="k">def</span><span class="w"> </span><span class="nf">clean_dataset</span><span class="p">(</span><span class="n">raw_data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="n">raw_data</span> <span class="o">=</span> <span class="n">raw_data</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">raw_data</span>

<span class="k">def</span><span class="w"> </span><span class="nf">statistics</span><span class="p">(</span><span class="n">clean_dataset</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="k">return</span> <span class="o">...</span>
</pre></div>
</div>
</section>
<section id="via-builder-with-cache">
<h3>via <code class="docutils literal notranslate"><span class="pre">Builder().with_cache()</span></code><a class="headerlink" href="#via-builder-with-cache" title="Link to this heading">Â¶</a></h3>
<p>Equivalently, we could set this behavior via the <code class="docutils literal notranslate"><span class="pre">Builder</span></code>. You can pass a list of node names to the keyword arguments <code class="docutils literal notranslate"><span class="pre">recompute</span></code>, <code class="docutils literal notranslate"><span class="pre">ignore</span></code>, and <code class="docutils literal notranslate"><span class="pre">disable</span></code>. Using <code class="docutils literal notranslate"><span class="pre">True</span></code> to enable that behavior for all nodes. For example, using <code class="docutils literal notranslate"><span class="pre">recompute=True</span></code> will force execution of all nodes and store their results in cache. Having <code class="docutils literal notranslate"><span class="pre">disable=True</span></code> is equivalent to not having the <code class="docutils literal notranslate"><span class="pre">.with_cache()</span></code> clause.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">my_dataflow</span>

<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">my_dataflow</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_cache</span><span class="p">(</span><span class="n">recompute</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;raw_data&quot;</span><span class="p">])</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
<section id="set-a-default-behavior">
<h3>Set a default behavior<a class="headerlink" href="#set-a-default-behavior" title="Link to this heading">Â¶</a></h3>
<p>By default, caching is â€œopt-outâ€ meaning all nodes are cached unless specified otherwise. To make it â€œopt-inâ€, where only the specified nodes are cached, set <code class="docutils literal notranslate"><span class="pre">default_behavior=&quot;disable&quot;</span></code>. You can also try different default behaviors.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">my_dataflow</span>

<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">my_dataflow</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_cache</span><span class="p">(</span>
        <span class="n">default</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;raw_data&quot;</span><span class="p">,</span> <span class="s2">&quot;statistics&quot;</span><span class="p">],</span>  <span class="c1"># set behavior DEFAULT</span>
        <span class="n">default_behavior</span><span class="o">=</span><span class="s2">&quot;disable&quot;</span>  <span class="c1"># all other nodes are DISABLE</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="code-version">
<h2>Code version<a class="headerlink" href="#code-version" title="Link to this heading">Â¶</a></h2>
<p>The <code class="docutils literal notranslate"><span class="pre">code_version</span></code> of a node is determined by hashing its source code, ignoring docstring and comments.</p>
<p>Importantly, Apache Hamilton will not version nested function calls. If you edit utility functions or upgrade Python libraries, the cache might incorrectly assume the code to be the same.</p>
<p>For example, take the following function <code class="docutils literal notranslate"><span class="pre">foo</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_increment</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">1</span>

<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">_increment</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>

<span class="c1"># foo&#39;s code version: 129064d4496facc003686e0070967051ceb82c354508a58440910eb82af300db</span>
</pre></div>
</div>
<p>Despite editing the nested <code class="docutils literal notranslate"><span class="pre">_increment()</span></code>, we get the same <code class="docutils literal notranslate"><span class="pre">code_version</span></code> because the content of <code class="docutils literal notranslate"><span class="pre">foo()</span></code> hasnâ€™t changed.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span><span class="w"> </span><span class="nf">_increment</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="mi">2</span>

<span class="k">def</span><span class="w"> </span><span class="nf">foo</span><span class="p">():</span>
    <span class="k">return</span> <span class="n">_increment</span><span class="p">(</span><span class="mi">13</span><span class="p">)</span>

<span class="c1"># foo&#39;s code version: 129064d4496facc003686e0070967051ceb82c354508a58440910eb82af300db</span>
</pre></div>
</div>
<p>In that case, <code class="docutils literal notranslate"><span class="pre">foo()</span></code> should return <code class="docutils literal notranslate"><span class="pre">13</span> <span class="pre">+</span> <span class="pre">2</span></code> instead of <code class="docutils literal notranslate"><span class="pre">13</span> <span class="pre">+</span> <span class="pre">1</span></code>. Unaware of the change in <code class="docutils literal notranslate"><span class="pre">_increment()</span></code>, the cache will find a <code class="docutils literal notranslate"><span class="pre">cache_key</span></code> match and return <code class="docutils literal notranslate"><span class="pre">13</span> <span class="pre">+</span> <span class="pre">1</span></code>.</p>
<p>A solution is to set the caching behavior to <code class="docutils literal notranslate"><span class="pre">RECOMPUTE</span></code> to force execute <code class="docutils literal notranslate"><span class="pre">foo()</span></code>. Another is to delete stored metadata or results to force re-execution.</p>
</section>
<section id="data-version">
<h2>Data version<a class="headerlink" href="#data-version" title="Link to this heading">Â¶</a></h2>
<p>Caching requires the ability to uniquely identify data (e.g., create a hash). By default, all Python primitive types (<code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">str</span></code>, <code class="docutils literal notranslate"><span class="pre">dict</span></code>, etc.) are supported and more types can be added via extensions (e.g., <code class="docutils literal notranslate"><span class="pre">pandas</span></code>). For types not explicitly supported, caching can still function by versioning the objectâ€™s internal <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> instead. However, this could be expensive to compute or less reliable than alternatives.</p>
<section id="recursion-depth">
<h3>Recursion depth<a class="headerlink" href="#recursion-depth" title="Link to this heading">Â¶</a></h3>
<p>To version complex objects, we recursively hash its values. For example, versioning an object <code class="docutils literal notranslate"><span class="pre">List[Dict[str,</span> <span class="pre">float]]</span></code> involves hashing all keys and values of all dictionaries. Versioning complex objects with large <code class="docutils literal notranslate"><span class="pre">__dict__</span></code> state can become expensive.</p>
<p>In practice, we need to need a maximum recursion depth because thereâ€™s a trade-off between the computational cost of hashing data and how accurately it uniquely identifies data (reduce hashing collisions).</p>
<p>Hereâ€™s how to set the max depth:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fingerprinting</span>
<span class="n">fingerprinting</span><span class="o">.</span><span class="n">set_max_depth</span><span class="p">(</span><span class="n">depth</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="support-additional-types">
<h3>Support additional types<a class="headerlink" href="#support-additional-types" title="Link to this heading">Â¶</a></h3>
<p>Additional types can be supported by registering a hashing function via the module <code class="docutils literal notranslate"><span class="pre">hamilton.io.fingerprinting</span></code>. It uses <a class="reference external" href="https://docs.python.org/3/library/functools.html#functools.singledispatch">&#64;functools.singledispatch</a> to register the hashing function per Python type. The function must return a <code class="docutils literal notranslate"><span class="pre">str</span></code>. The code snippets shows how to support polars <code class="docutils literal notranslate"><span class="pre">DataFrame</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">polars</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pl</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fingerprinting</span>

<span class="c1"># specify the type via the decorator</span>
<span class="nd">@fingerprinting</span><span class="o">.</span><span class="n">hash_value</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">hash_polars_dataframe</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert a polars dataframe to a list of row hashes, then hash the list.</span>
<span class="sd">    We consider that row order matters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># obj is of type `pl.DataFrame`</span>
    <span class="n">hash_per_row</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">hash_rows</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># fingerprinting.hash_value(...) will automatically hash primitive Python types</span>
    <span class="k">return</span> <span class="n">fingerprinting</span><span class="o">.</span><span class="n">hash_value</span><span class="p">(</span><span class="n">hash_per_row</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, you can register functions without using decorators.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.io</span><span class="w"> </span><span class="kn">import</span> <span class="n">fingerprinting</span>

<span class="k">def</span><span class="w"> </span><span class="nf">hash_polars_dataframe</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>

<span class="n">fingerprinting</span><span class="o">.</span><span class="n">hash_value</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">pl</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">hash_polars_dataframe</span><span class="p">)</span>
</pre></div>
</div>
<p>If you want to override the base case, the one defined by the function <code class="docutils literal notranslate"><span class="pre">hash_value()</span></code>, you can do so by registering a function for the type <code class="docutils literal notranslate"><span class="pre">object</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="nd">@fingerprinting</span><span class="o">.</span><span class="n">hash_value</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="nb">object</span><span class="p">)</span>
<span class="k">def</span><span class="w"> </span><span class="nf">hash_object</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> <span class="o">...</span>
</pre></div>
</div>
</section>
</section>
<section id="storage">
<h2>Storage<a class="headerlink" href="#storage" title="Link to this heading">Â¶</a></h2>
<p>The caching feature is powered by two data storages:</p>
<ul class="simple">
<li><p><strong>Metadata store</strong>: It contains information about past <code class="docutils literal notranslate"><span class="pre">Driver</span></code> executions (<strong>code version</strong>, <strong>data version</strong>, run id, etc.). From this metadata, Apache Hamilton determines if a node needs to be executed or not. This metadata is generally lightweight.</p></li>
<li><p><strong>Result store</strong>: Itâ€™s a key-value store that maps a <strong>data version</strong> to a <strong>result</strong>. Itâ€™s completely unaware of nodes, executions, etc. and simply holds the <strong>results</strong>. The result store can significantly grow in size depending on your usage. By default, all results are pickled, but <a class="reference internal" href="#cache-result-format"><span class="std std-ref">other formats are possible</span></a>.</p></li>
</ul>
<section id="setting-the-cache-path">
<h3>Setting the cache path<a class="headerlink" href="#setting-the-cache-path" title="Link to this heading">Â¶</a></h3>
<p>By default, the <strong>metadata</strong> and <strong>results</strong> are stored under a new subdirectory <code class="docutils literal notranslate"><span class="pre">./.hamilton_cache/</span></code>, next to the current directory. Alternatively, you can set a path via <code class="docutils literal notranslate"><span class="pre">.with_cache(path=...)</span></code> that will be applied to both stores.</p>
<section id="by-project">
<h4>By project<a class="headerlink" href="#by-project" title="Link to this heading">Â¶</a></h4>
<p>Centralizing your cache by project is useful when you have nodes that are reused across multiple dataflows (e.g., training and inference ML pipelines, feature engineering).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># training_script.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">training</span>

<span class="n">cache_path</span> <span class="o">=</span> <span class="s2">&quot;/path/to/project/hamilton_cache&quot;</span>
<span class="n">train_dr</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span><span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">training</span><span class="p">)</span><span class="o">.</span><span class="n">with_cache</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">cache_path</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>

<span class="c1"># inference_script.py</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">inference</span>

<span class="n">cache_path</span> <span class="o">=</span> <span class="s2">&quot;/path/to/project/hamilton_cache&quot;</span>
<span class="n">predict_dr</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span><span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">inference</span><span class="p">)</span><span class="o">.</span><span class="n">with_cache</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">cache_path</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="globally">
<h4>Globally<a class="headerlink" href="#globally" title="Link to this heading">Â¶</a></h4>
<p>Using a global cache is easier storage management. Since the metadata and the results for <em>all</em> your Apache Hamilton dataflows are in one place, it can be easier to cleanup disk space.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span><span class="w"> </span><span class="nn">pathlib</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">my_dataflow</span>

<span class="c1"># set the cache under the user&#39;s global directory for any operating system</span>
<span class="c1"># The `Path` is converted to a string.</span>
<span class="n">cache_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">pathlib</span><span class="o">.</span><span class="n">expanduser</span><span class="p">()</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s2">&quot;/.hamilton_cache&quot;</span><span class="p">))</span>
<span class="n">dr</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span><span class="o">.</span><span class="n">with_module</span><span class="p">(</span><span class="n">my_dataflow</span><span class="p">)</span><span class="o">.</span><span class="n">with_cache</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">cache_path</span><span class="p">)</span><span class="o">.</span><span class="n">build</span><span class="p">()</span>
</pre></div>
</div>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>It can be a good idea to store the cache path in an environment variable.</p>
</div>
</section>
<section id="separate-locations">
<h4>Separate locations<a class="headerlink" href="#separate-locations" title="Link to this heading">Â¶</a></h4>
<p>If you want the metadata and result stores to be at different location, you can instantiate and pass them to <code class="docutils literal notranslate"><span class="pre">.with_cache()</span></code>. In that case, <code class="docutils literal notranslate"><span class="pre">.with_cache()</span></code>â€™s <code class="docutils literal notranslate"><span class="pre">path</span></code> parameter will be ignored.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamitlon.io.store</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLiteMetadataStore</span><span class="p">,</span> <span class="n">ShelveResultStore</span>

<span class="n">metadata_store</span> <span class="o">=</span> <span class="n">SQLiteMetadataStore</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;~/.hamilton_cache&quot;</span><span class="p">)</span>
<span class="n">result_store</span> <span class="o">=</span> <span class="n">ShelveResultStore</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/my/project&quot;</span><span class="p">)</span>

<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">dataflow</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_cache</span><span class="p">(</span>
        <span class="n">metadata_store</span><span class="o">=</span><span class="n">metadata_store</span><span class="p">,</span>
        <span class="n">result_store</span><span class="o">=</span><span class="n">result_store</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="inspect-storage">
<h3>Inspect storage<a class="headerlink" href="#inspect-storage" title="Link to this heading">Â¶</a></h3>
<p>It is possible to directly interact with the metadata and result stores either by creating them or via <code class="docutils literal notranslate"><span class="pre">Driver.cache</span></code>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.caching.stores.sqlite</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLiteMetadataStore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.caching.stores.file</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileResultStore</span>

<span class="n">metadata_store</span> <span class="o">=</span> <span class="n">SQLiteMetadataStore</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;~/.hamilton_cache&quot;</span><span class="p">)</span>
<span class="n">result_store</span> <span class="o">=</span> <span class="n">FileResultStore</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;/path/to/my/project&quot;</span><span class="p">)</span>

<span class="n">metadata_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">context_key</span><span class="o">=...</span><span class="p">)</span>
<span class="n">result_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_version</span><span class="o">=...</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">my_dataflow</span>

<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">dataflow</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_cache</span><span class="p">()</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">metadata_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">context_key</span><span class="o">=...</span><span class="p">)</span>
<span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">result_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_version</span><span class="o">=...</span><span class="p">)</span>
</pre></div>
</div>
<p>A useful pattern is using the <code class="docutils literal notranslate"><span class="pre">Driver.cache</span></code> state or <cite>structured logs &lt;caching-structured-logs&gt;</cite> to retrieve a <strong>data version</strong> and query the <strong>result store</strong>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.caching.adapter</span><span class="w"> </span><span class="kn">import</span> <span class="n">CachingEventType</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">my_dataflow</span>

<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">dataflow</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_cache</span><span class="p">()</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>

<span class="n">dr</span><span class="o">.</span><span class="n">execute</span><span class="p">([</span><span class="s2">&quot;amount_per_country&quot;</span><span class="p">])</span>

<span class="c1"># via `cache.data_versions`; this points to the latest run</span>
<span class="n">data_version</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">data_versions</span><span class="p">[</span><span class="s2">&quot;amount_per_country&quot;</span><span class="p">]</span>
<span class="n">stored_result</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">result_store</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">data_version</span><span class="p">)</span>

<span class="c1"># via structured logs; this allows to query any run</span>
<span class="n">run_id</span> <span class="o">=</span> <span class="o">...</span>
<span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">logs</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="s2">&quot;debug&quot;</span><span class="p">)[</span><span class="n">run_id</span><span class="p">]:</span>
    <span class="k">if</span> <span class="p">(</span>
        <span class="n">event</span><span class="o">.</span><span class="n">event_type</span> <span class="o">==</span> <span class="n">CachingEventType</span><span class="o">.</span><span class="n">SET_RESULT</span>
        <span class="ow">and</span> <span class="n">event</span><span class="o">.</span><span class="n">node_name</span> <span class="o">==</span> <span class="s2">&quot;amount_per_country&quot;</span>
    <span class="p">):</span>
        <span class="n">data_version</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">value</span>
        <span class="k">break</span>

<span class="n">stored_result</span> <span class="o">=</span> <span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">result_store</span><span class="p">(</span><span class="n">data_version</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="in-memory">
<h3>In-memory<a class="headerlink" href="#in-memory" title="Link to this heading">Â¶</a></h3>
<p>You can enable in-memory caching by using the <code class="docutils literal notranslate"><span class="pre">InMemoryMetadataStore</span></code> and <code class="docutils literal notranslate"><span class="pre">InMemoryResultStore</span></code>. Caching behaves the same, but metadata and results are never persisted to disk. This is useful in notebooks and interactive sessions where results are only temporary relevant (e.g., experimentating with new features).</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>In-memory caching can quickly fill memory. We suggest selectively caching results to limit this issue.</p>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.caching.stores.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemoryMetadataStore</span><span class="p">,</span> <span class="n">InMemoryResultStore</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dataflow</span>

<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">dataflow</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_cache</span><span class="p">(</span>
        <span class="n">metadata_store</span><span class="o">=</span><span class="n">InMemoryMetadataStore</span><span class="p">(),</span>
        <span class="n">result_store</span><span class="o">=</span><span class="n">InMemoryResultStore</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
<p>In-memory stores also allow you to persist your entire in-memory session to disk or start your in-memory session by loading an existing cache. This is compatible with most implementations.</p>
<section id="persist-cache">
<h4>Persist cache<a class="headerlink" href="#persist-cache" title="Link to this heading">Â¶</a></h4>
<p>This snippet shows how to persist an in-memory cache to an sqlite-backed metadata store and a file-based result store. Note that you should persist both the metadata and results stores for this to be useful. The <code class="docutils literal notranslate"><span class="pre">.persist_to()</span></code> method will repeatedly call <code class="docutils literal notranslate"><span class="pre">.set()</span></code> on the destination store. Persisting multiple times will add to the already cached data.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.caching.stores.sqlite</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLiteMetadataStore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.caching.stores.file</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileResultStore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.caching.stores.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemoryMetadataStore</span><span class="p">,</span> <span class="n">InMemoryResultStore</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">my_dataflow</span>

<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">my_dataflow</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_cache</span><span class="p">(</span>
        <span class="n">metadata_store</span><span class="o">=</span><span class="n">InMemoryMetadataStore</span><span class="p">(),</span>
        <span class="n">result_store</span><span class="o">=</span><span class="n">InMemoryResultStore</span><span class="p">(),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># execute the Driver several time. This will populate the in-memory stores</span>
<span class="n">dr</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>

<span class="c1"># persist to disk</span>
<span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">metadata_store</span><span class="o">.</span><span class="n">persist_to</span><span class="p">(</span><span class="n">SQLiteMetadataStore</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;./.hamilton_cache&quot;</span><span class="p">))</span>
<span class="n">dr</span><span class="o">.</span><span class="n">cache</span><span class="o">.</span><span class="n">result_store</span><span class="o">.</span><span class="n">persist_to</span><span class="p">(</span><span class="n">FileResultStore</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;./.hamilton_cache&quot;</span><span class="p">))</span>
</pre></div>
</div>
</section>
<section id="load-cache">
<h4>Load cache<a class="headerlink" href="#load-cache" title="Link to this heading">Â¶</a></h4>
<p>This snippet loads in-memory data from persisted metadata and result stores. The <code class="docutils literal notranslate"><span class="pre">.load_from()</span></code> is a classmethod and returns an instance of the in-memory store. The method <code class="docutils literal notranslate"><span class="pre">InMemoryResultStore.load_from(...)</span></code> must receive as argument a result store, but also a metadata store or a list of <code class="docutils literal notranslate"><span class="pre">data_version</span></code> to load. This is because <code class="docutils literal notranslate"><span class="pre">ResultStore</span></code> implementations donâ€™t have a registry of stored results.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">hamilton</span><span class="w"> </span><span class="kn">import</span> <span class="n">driver</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.caching.stores.sqlite</span><span class="w"> </span><span class="kn">import</span> <span class="n">SQLiteMetadataStore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.caching.stores.file</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileResultStore</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">hamilton.caching.stores.memory</span><span class="w"> </span><span class="kn">import</span> <span class="n">InMemoryMetadataStore</span><span class="p">,</span> <span class="n">InMemoryResultStore</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">my_dataflow</span>

<span class="c1"># create persisted stores</span>
<span class="n">metadata_store</span> <span class="o">=</span> <span class="n">SQLiteMetadataStore</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;./.hamilton_cache&quot;</span><span class="p">)</span>
<span class="n">result_store</span> <span class="o">=</span> <span class="n">FileResultStore</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">&quot;./.hamilton_cache&quot;</span><span class="p">)</span>

<span class="n">dr</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">driver</span><span class="o">.</span><span class="n">Builder</span><span class="p">()</span>
    <span class="o">.</span><span class="n">with_modules</span><span class="p">(</span><span class="n">my_dataflow</span><span class="p">)</span>
    <span class="o">.</span><span class="n">with_cache</span><span class="p">(</span>
        <span class="c1"># create in-memory stores by loading from persisted store</span>
        <span class="n">metadata_store</span><span class="o">=</span><span class="n">InMemoryMetadataStore</span><span class="o">.</span><span class="n">load_from</span><span class="p">(</span><span class="n">metadata_store</span><span class="p">),</span>
        <span class="n">result_store</span><span class="o">=</span><span class="n">InMemoryResultStore</span><span class="o">.</span><span class="n">load_from</span><span class="p">(</span>
            <span class="n">result_store</span><span class="o">=</span><span class="n">result_store</span><span class="p">,</span>
            <span class="n">metadata_store</span><span class="o">=</span><span class="n">metadata_store</span><span class="p">,</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="o">.</span><span class="n">build</span><span class="p">()</span>
<span class="p">)</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="roadmap">
<h2>Roadmap<a class="headerlink" href="#roadmap" title="Link to this heading">Â¶</a></h2>
<p>Caching is a significant Apache Hamilton feature and there are plans to expand it. Here are some ideas and areas for development. Feel free comment on them or make other suggestions via <a class="reference external" href="https://join.slack.com/t/hamilton-opensource/shared_invite/zt-2niepkra8-DGKGf_tTYhXuJWBTXtIs4g">Slack</a> or GitHub!</p>
<ul class="simple">
<li><p><strong>Apache Hamilton UI integration</strong>: caching introduces the concept of <code class="docutils literal notranslate"><span class="pre">data_version</span></code>. This metadata could be captured by the Apache Hamilton UI to show how different values are used across dataflow executions. This would be particularly useful for experiment tracking and lineage.</p></li>
<li><p><strong>Distributed caching support</strong>: the initial release supports multithreading and multiprocessing on a single machine. For distributed execution, we will need <code class="docutils literal notranslate"><span class="pre">ResultStore</span></code> and <code class="docutils literal notranslate"><span class="pre">MetadataStore</span></code> that can be remote and are safe for concurrent access.</p></li>
<li><p><strong>Integrate with remote execution</strong> (Ray, Skypilot, Modal, Runhouse): facilitate a pattern where the dataflow is executed locally, but some nodes can selectively be executed remotely and have their results cached locally.</p></li>
<li><p><strong>async support</strong>: Support caching with <code class="docutils literal notranslate"><span class="pre">AsyncDriver</span></code>. This requires a significant amount of code, but the core logic shouldnâ€™t change much.</p></li>
<li><p><strong>cache eviction</strong>: Allow to set up a max storage (in size or number of items) or time-based policy to delete data from the metadata and result stores. This would help with managing the cache size.</p></li>
<li><p><strong>more store backends</strong>: The initial release includes backend supported by the Python standard library (SQLite metadata and file-based results). Could support more backends via <a class="reference external" href="https://filesystem-spec.readthedocs.io/en/latest/?badge=latest">fsspec</a> (AWS, Azure, GCP, Databricks, etc.)</p></li>
<li><p><strong>support more types</strong>: Include specialized hashing functions for complex objects from popular libraries. This can be done through Apache Hamilton extensions.</p></li>
</ul>
</section>
</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="../function-modifiers-advanced/">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Function modifiers (Advanced)</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../builder/">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Builder</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            <div class="last-updated">
              Last updated on Jun 23, 2025</div>
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Caching</a><ul>
<li><a class="reference internal" href="#how-does-it-work">How does it work?</a><ul>
<li><a class="reference internal" href="#cache-key">Cache key</a></li>
</ul>
</li>
<li><a class="reference internal" href="#observing-the-cache">Observing the cache</a><ul>
<li><a class="reference internal" href="#logging">Logging</a></li>
<li><a class="reference internal" href="#visualization">Visualization</a></li>
<li><a class="reference internal" href="#structured-logs">Structured logs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#cached-result-format">Cached result format</a></li>
<li><a class="reference internal" href="#caching-behavior">Caching behavior</a><ul>
<li><a class="reference internal" href="#setting-caching-behavior">Setting caching behavior</a></li>
<li><a class="reference internal" href="#via-cache">via <code class="docutils literal notranslate"><span class="pre">&#64;cache</span></code></a></li>
<li><a class="reference internal" href="#via-builder-with-cache">via <code class="docutils literal notranslate"><span class="pre">Builder().with_cache()</span></code></a></li>
<li><a class="reference internal" href="#set-a-default-behavior">Set a default behavior</a></li>
</ul>
</li>
<li><a class="reference internal" href="#code-version">Code version</a></li>
<li><a class="reference internal" href="#data-version">Data version</a><ul>
<li><a class="reference internal" href="#recursion-depth">Recursion depth</a></li>
<li><a class="reference internal" href="#support-additional-types">Support additional types</a></li>
</ul>
</li>
<li><a class="reference internal" href="#storage">Storage</a><ul>
<li><a class="reference internal" href="#setting-the-cache-path">Setting the cache path</a><ul>
<li><a class="reference internal" href="#by-project">By project</a></li>
<li><a class="reference internal" href="#globally">Globally</a></li>
<li><a class="reference internal" href="#separate-locations">Separate locations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#inspect-storage">Inspect storage</a></li>
<li><a class="reference internal" href="#in-memory">In-memory</a><ul>
<li><a class="reference internal" href="#persist-cache">Persist cache</a></li>
<li><a class="reference internal" href="#load-cache">Load cache</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#roadmap">Roadmap</a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../../_static/documentation_options.js?v=187304be"></script>
    <script src="../../_static/doctools.js?v=9bcbadda"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/scripts/furo.js?v=5fa4622c"></script>
    </body>
</html>